<!DOCTYPE html>
<html lang="en">
<head>
	<title>JS FE</title> 
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	
	<style>
		.done {
			text-decoration: line-through;
		}

		.del, .edit{
			display: inline-block;
			width: 24px;
			height: 24px;
			margin-left: 20px;
			background-size: contain;
		}
		
		.del{
			background-image: url('delete.png');
		}

		.edit{
			background-image: url('edit.png');
		}

		.hidden {
			display: none;
		}

	</style>
</head>
<body>

	<form class="todoform">
		<input class="todoinput" type="text" placeholder="Type your task here">
		<input type="submit" value="save">
	</form>

	<h3>Any tasks yet, type your first task and save above</h3>
	<ol class="list" data-type="todos" data-list="my_first_list" data-user="admin">
	</ol>


<script>

	const form = document.querySelector('.todoform');
	const todoinput = form.querySelector('.todoinput');
	const h3 = document.getElementsByTagName('h3')[0];
	const todolist = document.getElementsByClassName('list')[0];
	let todos;
	const APP_NAME = 'TODOLIST_JS0123'
	const storage = window.localStorage;

	function saveToLS(){
		storage.setItem(APP_NAME, JSON.stringify(todos));
	}

	if(storage.getItem(APP_NAME) == null){
		todos = [];
	}
	else{
		todos = JSON.parse(storage.getItem(APP_NAME));
		for(let todo of todos){
			createTodoMarkup(todo);
		}
	}


	function toggleListVSH3(){
		if(todos.length == 0){
			h3.style.display = 'block';
			todolist.style.display = 'none';
		}
		else{
			h3.style.display = 'none';
			todolist.style.display = 'block';
		}
	}

	toggleListVSH3();

	function saveTask(){
		const task = todoinput.value;
		if(task.length >= 2){
			let id = Date.now();
			// добавляем текст в массив
			const todo = {
				task: task,
				id: id,
				done: false
			}
			todos.push(todo);
			createTodoMarkup(todo);
			todoinput.value = '';

			if(todos.length === 1){
				toggleListVSH3();
			}
			saveToLS();
		}
		
	}

	function createTodoMarkup(todo){
		const li = document.createElement('li');
		// создаем кнопку удаления
		const delBtn = document.createElement('span');
		delBtn.classList.add('del');
		// создаем кнопку редактирования
		const editBtn = document.createElement('span');
		editBtn.classList.add('edit');
		// создаем поле для редактирования контента
		let inp = document.createElement('input');
		inp.value = todo.task;
		inp.classList.add('hidden');
		//текст задачи помещаем в span
		let taskText = document.createElement('span');
		taskText.textContent = todo.task;

		li.dataset.id = todo.id;
		li.append(inp);
		li.append(taskText);
		li.append(editBtn);
		li.append(delBtn);
		li.classList.add(todo.done ? 'done' : null);
		li.onclick = () => markAsDone(li);

		// добавляем li в список
		todolist.append(li);
	}

	form.onsubmit = (event) => {
		event.preventDefault();
		saveTask();
	}

	function markAsDone(elem){
		elem.classList.toggle('done');
		let id = elem.dataset.id;
		todos.forEach((item) => {
			if(item.id == id){
				item.done = !item.done;
			}
		});
		saveToLS();
	}

	function deleteTask(el){
		let id = el.dataset.id;
		el.remove();

		todos.forEach((item,index) => {
			if(item.id == id){
				todos.splice(index, 1);
			}
		});

		if(todos.length === 0){
			toggleListVSH3();
		}
		saveToLS();
	}

	function editTask(el){
		let id = el.dataset.id;

		const input = el.querySelector('input');
		const span = el.querySelector('span');
		// скрываем старый текст задачи и показываем поле для рекдактирования
		input.classList.remove('hidden');
		span.classList.add('hidden');
		// слушаем нажатия на клавиатуре
		input.onkeyup = (e) => {
			// если нажали Enter, заканчиваем редактирование и сохраняем результат
			if(e.key === 'Enter'){
				span.textContent = input.value;
				input.classList.add('hidden');
				span.classList.remove('hidden');

				todos.forEach((item) => {
					if(item.id == id){
						item.task = input.value;
					}
				});
				saveToLS();
			}
		}
	}

	todolist.addEventListener('click', (event)=>{
		if(event.target.classList.contains('del')){
			deleteTask(event.target.parentNode);
		}
		if(event.target.classList.contains('edit')){
			editTask(event.target.parentNode);
		}
	});


	// 1) базовая верстка +
	// 2) create task +
	// 3) mark as done +
	// 4) delete task +
	// 5) edit task +
	// 6) * save to ls - save to ls after createTask, delete and edit, get Items on script start +



</script>


</body>
</html>